<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/playlists.css">
    <link rel="shortcut icon" href="./assets/imgHome/logo discofone sozinho .svg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script> -->
    <!-- <script src="http://www.chartjs.org/samples/latest/utils.js"></script> -->
    <title>Retrofy</title>
</head>

<body>
    <div>
        <nav class="menu-lateral">
            <div class="botao_expandir">
                <i class="bi bi-music-note-list" id="botao-expandir"></i>
            </div>
            <ul>
                <li class="item-menu ativo">
                    <a href="playlists.html">
                        <span class="icon"><i class="bi bi-cassette"></i></span>
                        <span class="txt-link">Playlists</span>
                    </a>
                </li>
                <li class="item-menu">
                    <a href="quiz.html">
                        <span class="icon"><i class="bi bi-journal-check"></i></span>
                        <span class="txt-link">Quiz</span>
                    </a>
                </li>
                <li class="item-menu">
                    <a href="biblioteca.html">
                        <span class="icon"><i class="bi bi-heart"></i></span>
                        <span class="txt-link">Biblioteca</span>
                    </a>
                </li>
                <li class="item-menu">
                    <a href="dashboard.html">
                        <span class="icon"><i class="bi bi-bar-chart-line"></i></span>
                        <span class="txt-link">Dashboard</span>
                    </a>
                </li>
                <li class="item-menu">
                    <a href="./quizRock/contaConfig.html">
                        <span class="icon"><i class="bi bi-person-circle"></i></span>
                        <span class="txt-link">Conta</span>
                    </a>
                </li>
                <li class="item-menu">
                    <a href="index.html">
                        <span class="icon-sair"><i class="bi bi-box-arrow-left"></i></span>
                        <span class="txt-link-sair">Sair</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="div-full">
        <div class="div-filha">
            <div class="container-inicial">
                <h2 class="titulo-inicial">Bem vindo, <span id="b_usuario"></span>!</h2>
                <p>Entre de cabeça em uma experiência musical inesquecível!</p>
            </div>
            <div class="container-principal">
                <div class="txt-div">
                    <h3>Decida como quer a sua playlist!</h3>
                    <p>Uma playlist com recomendações feita para você.</p>
                </div>

                <div class="container-playlist">
                    <div class="container-genero">
                        <span>Selecione um gênero:</span>
                        <select name="generos" id="selectPlaylist">
                            <option style="color: darkgrey;" value="0">Selecione...</option>
                            <option value="1">Pop - 1960</option>
                            <option value="2">Pop - 1970</option>
                            <option value="3">Pop - 1980</option>
                            <option value="4">Rock - 1960</option>
                            <option value="5">Rock - 1970</option>
                            <option value="6">Rock - 1980</option>
                            <option value="7">Post Punk - 1980</option>
                        </select>
                    </div>
                </div>
                <button class="botao-playlist" onclick="gerarPlaylist()">Gerar Playlist!</button>
            </div>
        </div>             
            <div class="filha2">
            <h2 class="titulo-inicial">Playlists mais escolhidas</h2>
            <canvas id="myChart"></canvas>
        </div>
    </div> 
    <div class="retrofy">
        <div id="res"></div>
    </div>   
</body>
</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO

    let proximaAtualizacao;
    const ctx = document.getElementById('myChart');
    var dados = {
            labels: [],
            datasets: [
                {
                    label: 'Votos',
                    data: [],
                    backgroundColor: ['#F887C9', '#BF6BB6', '#85529F', '#4B3B83', '#002563', '#0000FF'],
                }
                ]
            };

    var grafico = new Chart(ctx, {
        type: 'pie',
        data: dados
    })
  
   async function plotarGrafico() {
        console.log('iniciando plotagem do gráfico...');

        var dados = await fetch('/medidas/playlistFav').then(resposta => {
            if(resposta.ok){
                return resposta.json()
            }
        }) 
        grafico.data.labels = []
        grafico.data.datasets[0].data =[]
        dados.forEach(element => {
            grafico.data.labels.push(element.nome_playlist)
            grafico.data.datasets[0].data.push(element.voto)
        });

        grafico.update();
    }


    plotarGrafico()

    setInterval(plotarGrafico, 1000)

</script>

<script>

</script>



<script src="./js/playlists.js"></script>